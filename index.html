<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>NoxiustDrive</title>
  <style>
    :root{
      --bg:#0b1220;
      --glass: rgba(15,23,42,.70);
      --glass2: rgba(17,28,51,.55);
      --glass3: rgba(255,255,255,.06);
      --border: rgba(255,255,255,.12);
      --border2: rgba(255,255,255,.16);
      --text: #e5e7eb;
      --muted:#a7b0bf;
      --accent:#60a5fa;
      --accent2:#93c5fd;
      --ok:#34d399;
      --danger:#fb7185;
      --shadow: 0 24px 90px rgba(0,0,0,.70);
      --font: system-ui, -apple-system, "Segoe UI Variable", "Segoe UI", Roboto, Arial, sans-serif;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      --r: 14px;
    }
    *{ box-sizing:border-box; }
    html, body { height:100%; }

    body{
      margin:0;
      overflow:hidden;
      font-family:var(--font);
      color:var(--text);
      background: radial-gradient(1200px 800px at 15% 10%, rgba(96,165,250,.18), transparent 60%),
                  radial-gradient(900px 600px at 85% 20%, rgba(52,211,153,.12), transparent 60%),
                  linear-gradient(180deg, #070b16, var(--bg));
    }

    /* ===== App Shell (Fullscreen) ===== */
    .window{
      width:100vw;
      height:100vh;
      display:flex;
      flex-direction:column;
      background: var(--glass);
      backdrop-filter: blur(14px);
      overflow:hidden;
    }

    /* ===== Top Area (Win-ish) ===== */
    .titlebar{
      height:46px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:0 10px 0 12px;
      background: rgba(2,6,23,.58);
      border-bottom:1px solid var(--border);
      user-select:none;
    }
    .title-left{ display:flex; align-items:center; gap:10px; min-width:260px; }
    .appicon{
      width:26px;height:26px;border-radius:8px;
      display:grid;place-items:center;
      background:rgba(96,165,250,.16);
      border:1px solid rgba(96,165,250,.25);
      font-size:14px;
    }
    .apptitle{ display:flex; flex-direction:column; line-height:1.05; }
    .apptitle b{ font-size:.98rem; letter-spacing:.2px; }
    .apptitle span{ font-size:.78rem; color:var(--muted); }

    .winbtns{ display:flex; gap:8px; align-items:center; opacity:.8; }
    .dotbtn{
      width:12px;height:12px;border-radius:50%;
      background:rgba(255,255,255,0.18);
      border:1px solid rgba(255,255,255,0.14);
    }
    .dotbtn.close{ background: rgba(251,113,133,.35); border-color: rgba(251,113,133,.30); }

    /* ===== Command bar (Win11-ish) ===== */
    .cmdbar{
      display:flex;
      align-items:center;
      gap:10px;
      padding:10px 12px;
      background: var(--glass2);
      border-bottom:1px solid var(--border);
      user-select:none;
    }
    .btn{
      appearance:none;
      border:1px solid var(--border2);
      background: rgba(255,255,255,.06);
      color:var(--text);
      padding:8px 10px;
      border-radius: 12px;
      cursor:pointer;
      font-size:.92rem;
      display:inline-flex;
      align-items:center;
      gap:8px;
      transition: background .12s, border-color .12s, transform .06s;
      white-space:nowrap;
    }
    .btn:hover{ background: rgba(255,255,255,.10); border-color: rgba(255,255,255,.22); }
    .btn:active{ transform: translateY(1px); }
    .btn:disabled{ opacity:.45; cursor:not-allowed; }
    .btn.primary{
      border-color: rgba(96,165,250,.40);
      background: rgba(96,165,250,.18);
    }
    .pill{
      display:flex; align-items:center; gap:8px;
      padding:8px 10px;
      border-radius:999px;
      border:1px solid var(--border2);
      background: rgba(255,255,255,.06);
      color: var(--muted);
      font-size:.86rem;
    }
    .statusDot{
      width:10px;height:10px;border-radius:50%;
      background: var(--danger);
      box-shadow: 0 0 0 6px rgba(251,113,133,.12);
    }

    /* ===== Address row ===== */
    .addrrow{
      display:flex;
      align-items:center;
      gap:10px;
      padding:10px 12px;
      background: rgba(17,28,51,.42);
      border-bottom:1px solid var(--border);
    }
    .addrWrap{
      flex:1;
      display:flex;
      align-items:center;
      gap:10px;
      min-width:0;
    }

    .navbtns{ display:flex; gap:8px; }
    .small{
      padding:8px 10px;
      border-radius: 12px;
    }

    .addr{
      flex:1;
      display:flex;
      align-items:center;
      gap:6px;
      padding:8px 10px;
      border-radius: 12px;
      border:1px solid var(--border2);
      background: rgba(255,255,255,.05);
      overflow:auto;
      scrollbar-width: thin;
      min-width:0;
    }
    .crumb{
      display:inline-flex;
      align-items:center;
      gap:6px;
      color: var(--muted);
      font-size:.92rem;
      white-space:nowrap;
    }
    .crumb button{
      border:0;
      background: transparent;
      color: var(--text);
      cursor:pointer;
      padding:4px 6px;
      border-radius:10px;
      font-size:.92rem;
    }
    .crumb button:hover{ background: rgba(255,255,255,.08); }
    .sep{ color: rgba(156,163,175,.7); }

    .addrEdit{
      display:none;
      flex:1;
      min-width:0;
      padding:10px 12px;
      border-radius: 12px;
      border:1px solid rgba(96,165,250,.55);
      background: rgba(2,6,23,.55);
      color: var(--text);
      outline:none;
      font-size:.92rem;
      font-family: var(--mono);
    }

    .search{
      width: min(420px, 45vw);
      display:flex;
      align-items:center;
      gap:8px;
      padding:8px 10px;
      border-radius: 12px;
      border:1px solid var(--border2);
      background: rgba(255,255,255,.05);
    }
    .search input{
      width:100%;
      border:0;
      outline:none;
      background:transparent;
      color:var(--text);
      font-size:.92rem;
    }

    /* ===== Main Layout ===== */
    .body{
      flex:1;
      display:flex;
      min-height:0;
    }

    /* Left nav (Quick access + This PC) */
    .left{
      width: 310px;
      min-width: 270px;
      background: rgba(2,6,23,.33);
      border-right:1px solid var(--border);
      padding:10px;
      display:flex;
      flex-direction:column;
      gap:10px;
      min-height:0;
    }

    .panehdr{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding: 8px 10px;
      border-radius: 12px;
      border:1px solid rgba(255,255,255,0.10);
      background: rgba(255,255,255,0.04);
      color: var(--muted);
      font-size:.84rem;
      letter-spacing:.08em;
      text-transform: uppercase;
      user-select:none;
    }

    .tree{
      overflow:auto;
      padding-right:6px;
    }

    .node{
      display:flex;
      align-items:center;
      gap:8px;
      padding:8px 8px;
      border-radius: 12px;
      cursor:pointer;
      user-select:none;
      border:1px solid transparent;
      outline:none;
    }
    .node:hover{
      background:rgba(255,255,255,0.06);
      border-color: rgba(255,255,255,0.10);
    }
    .node:focus{
      border-color: rgba(147,197,253,.55);
      box-shadow: 0 0 0 3px rgba(147,197,253,.12);
    }
    .node.active{
      background: rgba(96,165,250,.14);
      border-color: rgba(96,165,250,.25);
    }

    .twisty{
      width:18px;
      display:grid;
      place-items:center;
      font-size: 12px;
      opacity:.9;
    }
    .icon{
      width:28px;height:28px;
      display:grid;place-items:center;
      border-radius: 10px;
      background: rgba(255,255,255,0.06);
      border:1px solid rgba(255,255,255,0.10);
      font-size: 14px;
    }
    .label{
      display:flex;
      flex-direction:column;
      line-height:1.15;
      min-width:0;
    }
    .label b{
      font-size:.93rem;
      overflow:hidden;
      white-space:nowrap;
      text-overflow:ellipsis;
    }
    .label span{
      font-size:.78rem;
      color:var(--muted);
      overflow:hidden;
      white-space:nowrap;
      text-overflow:ellipsis;
    }
    .children{
      margin-left: 26px;
      display:none;
      padding-left: 10px;
      border-left:1px dashed rgba(255,255,255,0.12);
    }
    .children.show{ display:block; }

    /* Middle list */
    .main{
      flex:1;
      min-width:0;
      padding:12px;
      display:flex;
      flex-direction:column;
      min-height:0;
      gap:10px;
    }

    .list{
      flex:1;
      min-height:0;
      border:1px solid var(--border);
      border-radius: var(--r);
      background: rgba(255,255,255,0.04);
      overflow:hidden;
      display:flex;
      flex-direction:column;
    }

    .listhead{
      display:grid;
      grid-template-columns: 1.55fr .75fr .85fr;
      padding:10px 12px;
      background: rgba(255,255,255,0.04);
      border-bottom:1px solid var(--border);
      color: var(--muted);
      font-size:.82rem;
      user-select:none;
    }
    .rows{ overflow:auto; flex:1; outline:none; }
    .row{
      display:grid;
      grid-template-columns: 1.55fr .75fr .85fr;
      padding:10px 12px;
      border-bottom:1px solid rgba(255,255,255,0.06);
      align-items:center;
      cursor:pointer;
      user-select:none;
      transition: background .10s, border-color .10s;
      border-left:3px solid transparent;
    }
    .row:hover{ background: rgba(255,255,255,0.06); }
    .row.selected{
      background: rgba(96,165,250,.18);
      border-left-color: rgba(96,165,250,.70);
    }
    .row:focus{
      outline:none;
      box-shadow: inset 0 0 0 2px rgba(147,197,253,.45);
    }

    .cellname{
      display:flex;
      align-items:center;
      gap:10px;
      min-width:0;
    }
    .fileicon{
      width:30px;height:30px;
      border-radius: 10px;
      display:grid;
      place-items:center;
      background: rgba(96,165,250,.14);
      border:1px solid rgba(96,165,250,.20);
      font-size: 14px;
      flex:0 0 auto;
    }
    .nametext{
      min-width:0;
      display:flex;
      flex-direction:column;
      gap:2px;
    }
    .nametext b{
      font-size:.95rem;
      overflow:hidden;
      white-space:nowrap;
      text-overflow:ellipsis;
    }
    .nametext span{
      font-size:.8rem;
      color:var(--muted);
      overflow:hidden;
      white-space:nowrap;
      text-overflow:ellipsis;
      font-family: var(--mono);
    }
    .type,.modified{ color: var(--muted); font-size:.9rem; }

    /* Right details */
    .details{
      width: 360px;
      min-width: 320px;
      background: rgba(2,6,23,.33);
      border-left:1px solid var(--border);
      padding:12px;
      display:flex;
      flex-direction:column;
      gap:10px;
      min-height:0;
    }

    .preview{
      border:1px solid rgba(255,255,255,0.10);
      background: rgba(255,255,255,0.04);
      border-radius: 16px;
      padding:12px;
      min-height: 170px;
      display:flex;
      align-items:center;
      justify-content:center;
      position:relative;
      overflow:hidden;
      user-select:none;
    }
    .bigicon{ font-size: 52px; opacity:.95; }
    .preview small{
      position:absolute;
      bottom:10px;
      left:12px;
      right:12px;
      color: rgba(167,176,191,.95);
      font-size:.82rem;
      overflow:hidden;
      white-space:nowrap;
      text-overflow:ellipsis;
      font-family: var(--mono);
    }

    .props{
      border:1px solid rgba(255,255,255,0.10);
      background: rgba(255,255,255,0.04);
      border-radius: 16px;
      padding:12px;
      overflow:auto;
      flex:1;
    }
    .props h3{
      margin:0 0 10px 0;
      font-size: .95rem;
      color: rgba(229,231,235,.92);
      user-select:none;
    }
    .kv{
      display:grid;
      grid-template-columns: 1fr 1.2fr;
      gap:8px 10px;
      font-size:.88rem;
    }
    .k{ color: var(--muted); user-select:none; }
    .v{
      color: rgba(229,231,235,.92);
      font-family: var(--mono);
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
    }

    .statusbar{
      height:34px;
      border-top:1px solid var(--border);
      background: rgba(2,6,23,.45);
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:0 12px;
      color: var(--muted);
      font-size:.86rem;
      user-select:none;
    }

    /* ===== Locked blur (only app area) ===== */
    .locked .titlebar,
    .locked .cmdbar,
    .locked .addrrow,
    .locked .body,
    .locked .statusbar{
      filter: blur(10px);
      pointer-events:none;
      opacity:.55;
    }

    /* ===== Context Menu (Open only) ===== */
    .ctx{
      position: fixed;
      z-index: 10000;
      display:none;
      min-width: 170px;
      background: rgba(2,6,23,0.92);
      border: 1px solid rgba(255,255,255,0.14);
      border-radius: 14px;
      box-shadow: 0 16px 50px rgba(0,0,0,0.65);
      padding: 6px;
      backdrop-filter: blur(16px);
      user-select:none;
    }
    .ctx button{
      width:100%;
      border:0;
      background: transparent;
      color: var(--text);
      padding: 10px 10px;
      border-radius: 10px;
      cursor:pointer;
      text-align:left;
      font-size: .92rem;
    }
    .ctx button:hover{ background: rgba(255,255,255,0.08); }
    .ctx button:disabled{ opacity:.45; cursor:not-allowed; }

    /* ===== Lock Screen (Windows-like) ===== */
    .lock{
      position: fixed;
      inset:0;
      z-index: 99999;
      display:none;
      background:
        linear-gradient(180deg, rgba(0,0,0,.15), rgba(0,0,0,.65)),
        url("pictures/wallpapers/wallpaper.jpeg");
      background-size: cover;
      background-position: center;
      background-repeat:no-repeat;
      user-select:none;
      color: white;
    }
    .lock.show{ display:block; }

    .lockTop{
      position:absolute;
      inset:0;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap:10px;
      transition: opacity .18s ease, transform .18s ease;
    }
    .time{
      font-size: 64px;
      font-weight: 600;
      letter-spacing: .5px;
      text-shadow: 0 18px 50px rgba(0,0,0,.55);
    }
    .date{
      font-size: 18px;
      color: rgba(255,255,255,.90);
      text-shadow: 0 18px 50px rgba(0,0,0,.55);
    }
    .hint{
      margin-top: 18px;
      font-size: 14px;
      color: rgba(255,255,255,.85);
      padding: 8px 12px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(0,0,0,.22);
      backdrop-filter: blur(10px);
    }

    .signin{
      position:absolute;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      opacity:0;
      pointer-events:none;
      transition: opacity .20s ease;
    }
    .signin.show{
      opacity:1;
      pointer-events:auto;
    }
    .signinCard{
      width:min(520px, calc(100vw - 44px));
      background: rgba(2,6,23,0.55);
      border: 1px solid rgba(255,255,255,0.14);
      border-radius: 22px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(18px);
      padding: 18px;
    }
    .signinHead{
      display:flex;
      align-items:center;
      gap:12px;
      margin-bottom: 14px;
    }
    .avatar{
      width:46px;height:46px;border-radius: 16px;
      display:grid;place-items:center;
      background: rgba(96,165,250,0.18);
      border: 1px solid rgba(96,165,250,0.25);
      font-size: 18px;
    }
    .signinTitle{ display:flex; flex-direction:column; line-height:1.1; }
    .signinTitle b{ font-size: 1.08rem; }
    .signinTitle span{ color: rgba(255,255,255,.78); font-size: .88rem; }

    .inp{
      width:100%;
      padding: 12px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.07);
      color: white;
      outline:none;
      font-size: .96rem;
    }
    .inp:focus{ border-color: rgba(96,165,250,.75); }
    .err{
      min-height: 18px;
      margin-top: 8px;
      font-size:.9rem;
      color: rgba(251,113,133,.95);
    }
    .signinBtns{
      display:flex;
      justify-content:flex-end;
      gap:10px;
      margin-top: 12px;
    }
    .ghost{
      border-color: rgba(255,255,255,.18);
      background: rgba(0,0,0,.18);
    }
  </style>
</head>

<body>
  <div class="window locked" id="win">
    <div class="titlebar">
      <div class="title-left">
        <div class="appicon">üóÇÔ∏è</div>
        <div class="apptitle">
          <b>NoxiustDrive</b>
          <span id="subtitle">Locked</span>
        </div>
      </div>
      <div class="winbtns" aria-hidden="true">
        <div class="dotbtn"></div>
        <div class="dotbtn"></div>
        <div class="dotbtn close"></div>
      </div>
    </div>

    <div class="cmdbar">
      <div style="display:flex; gap:8px; align-items:center;">
        <button class="btn small" id="backBtn" disabled title="Back (Alt+Left)">‚¨ÖÔ∏è</button>
        <button class="btn small" id="forwardBtn" disabled title="Forward (Alt+Right)">‚û°Ô∏è</button>
        <button class="btn small" id="upBtn" disabled title="Up (Backspace)">‚¨ÜÔ∏è</button>
      </div>

      <button class="btn" id="openBtn" disabled>üìÇ Open</button>
      <button class="btn" id="refreshBtn">üîÑ Refresh</button>

      <div style="flex:1"></div>

      <div class="pill">
        <span class="statusDot" id="statusDot"></span>
        <span id="statusText">Locked</span>
      </div>

      <button class="btn primary" id="loginBtn">üîê Sign in</button>
      <button class="btn" id="logoutBtn" style="display:none;">üö™ Lock</button>
    </div>

    <div class="addrrow">
      <div class="addrWrap">
        <div class="addr" id="addr" title="Click to edit (Ctrl+L)"></div>
        <input class="addrEdit" id="addrEdit" spellcheck="false" />
      </div>

      <div class="search" title="Search (filters list)">
        üîé <input id="searchBox" placeholder="Search" />
      </div>
    </div>

    <div class="body">
      <!-- Left navigation -->
      <div class="left">
        <div class="panehdr">
          <span>Navigation</span>
          <button class="btn small" id="collapseAllBtn" title="Collapse all">‚ûñ</button>
        </div>
        <div class="tree" id="tree"></div>
      </div>

      <!-- Middle list -->
      <div class="main">
        <div class="list" id="list">
          <div class="listhead">
            <div>Name</div>
            <div>Type</div>
            <div>Date modified</div>
          </div>
          <div class="rows" id="rows" tabindex="0" aria-label="File list"></div>
        </div>
      </div>

      <!-- Right details -->
      <div class="details">
        <div class="panehdr">
          <span>Details</span>
          <span style="color:var(--muted); font-size:.85rem;">Preview + Properties</span>
        </div>

        <div class="preview">
          <div class="bigicon" id="bigicon">üóÇÔ∏è</div>
          <small id="previewLabel">Select an item</small>
        </div>

        <div class="props">
          <h3>Properties</h3>
          <div class="kv" id="kv">
            <div class="k">Name</div><div class="v">‚Äî</div>
            <div class="k">Type</div><div class="v">‚Äî</div>
            <div class="k">Path</div><div class="v">‚Äî</div>
            <div class="k">Modified</div><div class="v">‚Äî</div>
            <div class="k">Size</div><div class="v">‚Äî</div>
          </div>
        </div>
      </div>
    </div>

    <div class="statusbar">
      <div id="sbLeft">0 items</div>
      <div id="sbRight">Ready</div>
    </div>
  </div>

  <!-- Context menu -->
  <div class="ctx" id="ctxMenu">
    <button id="ctxOpen" disabled>Open</button>
  </div>

  <!-- Lock Screen -->
  <div class="lock show" id="lock">
    <div class="lockTop" id="lockTop">
      <div class="time" id="lockTime">--:--</div>
      <div class="date" id="lockDate">---</div>
      <div class="hint">Click or press Enter to sign in</div>
    </div>

    <div class="signin" id="signin">
      <div class="signinCard" role="dialog" aria-modal="true">
        <div class="signinHead">
          <div class="avatar">üîí</div>
          <div class="signinTitle">
            <b>NoxiustDrive</b>
            <span>Sign in</span>
          </div>
        </div>

        <input class="inp" id="user" placeholder="Username" autocomplete="username" />
        <div style="height:10px"></div>
        <input class="inp" id="pass" placeholder="Password" type="password" autocomplete="current-password" />

        <div class="err" id="msg"></div>

        <div class="signinBtns">
          <button class="btn ghost" id="cancelBtn">Cancel</button>
          <button class="btn primary" id="submitBtn">Unlock</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    /* =======================
       AUTH (hash only)
       ======================= */
    const EXPECTED_USER = "y8tireu";
    const SALT = "p9$V3!n2";
    // SHA256("y8tireu:051285:p9$V3!n2")
    const EXPECTED_HASH_HEX = "1007e61100fc2fae55839e2aba29000155e956343aeb1e4f67a792aa08cbb350";

    async function sha256Hex(input){
      const enc = new TextEncoder();
      const data = enc.encode(input);
      const digest = await crypto.subtle.digest("SHA-256", data);
      const bytes = new Uint8Array(digest);
      return Array.from(bytes).map(b => b.toString(16).padStart(2,"0")).join("");
    }

    /* =======================
       VIRTUAL MODEL
       - folders navigate inside app
       - files redirect to their path
       ======================= */
    const FS = {
      "": [
        { name:"Documents", path:"documents/", kind:"folder", type:"File folder", icon:"üìÑ", modified:"‚Äî", size:"‚Äî" },
        { name:"Music",     path:"music/",     kind:"folder", type:"File folder", icon:"üéµ", modified:"‚Äî", size:"‚Äî" },
        { name:"Pictures",  path:"pictures/",  kind:"folder", type:"File folder", icon:"üñºÔ∏è", modified:"‚Äî", size:"‚Äî" },
        { name:"Videos",    path:"videos/",    kind:"folder", type:"File folder", icon:"üé¨", modified:"‚Äî", size:"‚Äî" },
      ],
      "documents/": [
        { name:"Resume.pdf", path:"documents/Resume.pdf", kind:"file", type:"PDF File", icon:"üìï", modified:"‚Äî", size:"‚Äî" },
        { name:"Notes.txt",  path:"documents/Notes.txt",  kind:"file", type:"Text Document", icon:"üìù", modified:"‚Äî", size:"‚Äî" }
      ],
      "music/": [
        { name:"Track01.mp3", path:"music/Track01.mp3", kind:"file", type:"MP3 File", icon:"üéß", modified:"‚Äî", size:"‚Äî" }
      ],
      "pictures/": [
        { name:"wallpapers", path:"pictures/wallpapers/", kind:"folder", type:"File folder", icon:"üß©", modified:"‚Äî", size:"‚Äî" },
        { name:"Photo01.jpg", path:"pictures/Photo01.jpg", kind:"file", type:"JPEG image", icon:"üñºÔ∏è", modified:"‚Äî", size:"‚Äî" }
      ],
      "pictures/wallpapers/": [
        { name:"wallpaper.jpeg", path:"pictures/wallpapers/wallpaper.jpeg", kind:"file", type:"JPEG image", icon:"üñºÔ∏è", modified:"‚Äî", size:"‚Äî" }
      ],
      "videos/": [
        { name:"Clip01.mp4", path:"videos/Clip01.mp4", kind:"file", type:"MP4 video", icon:"üéûÔ∏è", modified:"‚Äî", size:"‚Äî" }
      ],
    };

    const TREE = [
      { id:"qa", name:"Quick access", icon:"‚≠ê", hint:"", children:[
        { id:"home", name:"NoxiustDrive", icon:"üóÇÔ∏è", path:"", hint:"" },
        { id:"docs", name:"Documents", icon:"üìÑ", path:"documents/", hint:"" },
        { id:"pics", name:"Pictures", icon:"üñºÔ∏è", path:"pictures/", hint:"" },
      ]},
      { id:"thispc", name:"This PC", icon:"üñ•Ô∏è", hint:"NoxiustDrive", children:[
        { id:"music", name:"Music", icon:"üéµ", path:"music/", hint:"" },
        { id:"vids", name:"Videos", icon:"üé¨", path:"videos/", hint:"" },
      ]}
    ];

    /* =======================
       DOM
       ======================= */
    const win = document.getElementById("win");
    const subtitle = document.getElementById("subtitle");
    const statusDot = document.getElementById("statusDot");
    const statusText = document.getElementById("statusText");
    const sbLeft = document.getElementById("sbLeft");
    const sbRight = document.getElementById("sbRight");

    const backBtn = document.getElementById("backBtn");
    const forwardBtn = document.getElementById("forwardBtn");
    const upBtn = document.getElementById("upBtn");
    const openBtn = document.getElementById("openBtn");
    const refreshBtn = document.getElementById("refreshBtn");
    const loginBtn = document.getElementById("loginBtn");
    const logoutBtn = document.getElementById("logoutBtn");

    const addr = document.getElementById("addr");
    const addrEdit = document.getElementById("addrEdit");
    const searchBox = document.getElementById("searchBox");

    const treeEl = document.getElementById("tree");
    const collapseAllBtn = document.getElementById("collapseAllBtn");

    const rowsEl = document.getElementById("rows");
    const bigicon = document.getElementById("bigicon");
    const previewLabel = document.getElementById("previewLabel");
    const kv = document.getElementById("kv");

    const ctxMenu = document.getElementById("ctxMenu");
    const ctxOpen = document.getElementById("ctxOpen");

    // Lock screen
    const lock = document.getElementById("lock");
    const lockTop = document.getElementById("lockTop");
    const signin = document.getElementById("signin");
    const lockTime = document.getElementById("lockTime");
    const lockDate = document.getElementById("lockDate");
    const userEl = document.getElementById("user");
    const passEl = document.getElementById("pass");
    const msg = document.getElementById("msg");
    const submitBtn = document.getElementById("submitBtn");
    const cancelBtn = document.getElementById("cancelBtn");

    /* =======================
       STATE
       ======================= */
    let currentPath = "";
    let selectedIndex = -1;
    let filtered = [];
    let expanded = new Set(["qa","thispc"]);

    let backStack = [];
    let forwardStack = [];

    function normalizePath(p){
      if(!p) return "";
      return p.endsWith("/") ? p : (p + "/");
    }
    function nowDate(){
      return new Date().toLocaleDateString(undefined, { year:"numeric", month:"short", day:"2-digit" });
    }

    function setLocked(isLocked){
      if(isLocked){
        win.classList.add("locked");
        subtitle.textContent = "Locked";
        statusText.textContent = "Locked";
        statusDot.style.background = "var(--danger)";
        statusDot.style.boxShadow = "0 0 0 6px rgba(251,113,133,.12)";
        loginBtn.style.display = "inline-flex";
        logoutBtn.style.display = "none";
      }else{
        win.classList.remove("locked");
        subtitle.textContent = "Unlocked";
        statusText.textContent = "Unlocked";
        statusDot.style.background = "var(--ok)";
        statusDot.style.boxShadow = "0 0 0 6px rgba(52,211,153,.12)";
        loginBtn.style.display = "none";
        logoutBtn.style.display = "inline-flex";
      }
    }

    function showLock(show){
      lock.classList.toggle("show", show);
      if(show){
        signin.classList.remove("show");
        lockTop.style.opacity = "1";
        lockTop.style.transform = "translateY(0)";
        msg.textContent = "";
        userEl.value = "";
        passEl.value = "";
      }
    }

    function showSignin(){
      signin.classList.add("show");
      lockTop.style.opacity = "0";
      lockTop.style.transform = "translateY(-12px)";
      setTimeout(()=>userEl.focus(), 50);
    }
    function hideSignin(){
      signin.classList.remove("show");
      lockTop.style.opacity = "1";
      lockTop.style.transform = "translateY(0)";
      msg.textContent = "";
      userEl.value = "";
      passEl.value = "";
    }

    function getEntries(path){
      path = normalizePath(path);
      return FS[path] ? [...FS[path]] : [];
    }
    function applyFilter(){
      const q = (searchBox.value || "").trim().toLowerCase();
      const items = getEntries(currentPath);
      filtered = !q ? items : items.filter(e =>
        (e.name||"").toLowerCase().includes(q) ||
        (e.type||"").toLowerCase().includes(q) ||
        (e.path||"").toLowerCase().includes(q)
      );
      if(filtered.length === 0) selectedIndex = -1;
      else if(selectedIndex < 0 || selectedIndex >= filtered.length) selectedIndex = 0;
    }

    function navigate(path, pushHistory=true){
      path = normalizePath(path);
      if(path === currentPath) return;

      if(pushHistory){
        backStack.push(currentPath);
        forwardStack = [];
      }
      currentPath = path;
      selectedIndex = -1;
      searchBox.value = "";
      hideCtx();
      renderAll();
    }

    function goBack(){
      if(backStack.length === 0) return;
      forwardStack.push(currentPath);
      currentPath = backStack.pop();
      selectedIndex = -1;
      searchBox.value = "";
      hideCtx();
      renderAll();
    }
    function goForward(){
      if(forwardStack.length === 0) return;
      backStack.push(currentPath);
      currentPath = forwardStack.pop();
      selectedIndex = -1;
      searchBox.value = "";
      hideCtx();
      renderAll();
    }
    function goUp(){
      if(!currentPath) return;
      const clean = currentPath.replace(/\/$/,"");
      const up = clean.includes("/") ? clean.split("/").slice(0,-1).join("/") + "/" : "";
      navigate(up);
    }

    function selectedItem(){
      if(selectedIndex < 0 || selectedIndex >= filtered.length) return null;
      return filtered[selectedIndex];
    }

    function openSelected(){
      const it = selectedItem();
      if(!it) return;

      // Folder opens inside app; file redirects
      if(it.kind === "folder"){
        navigate(it.path);
      }else{
        window.location.href = it.path;
      }
    }

    function updateDetails(){
      const it = selectedItem();
      openBtn.disabled = !it;
      ctxOpen.disabled = !it;

      if(!it){
        bigicon.textContent = "üóÇÔ∏è";
        previewLabel.textContent = "Select an item";
        kv.innerHTML = `
          <div class="k">Name</div><div class="v">‚Äî</div>
          <div class="k">Type</div><div class="v">‚Äî</div>
          <div class="k">Path</div><div class="v">‚Äî</div>
          <div class="k">Modified</div><div class="v">‚Äî</div>
          <div class="k">Size</div><div class="v">‚Äî</div>
        `;
        sbRight.textContent = "Ready";
        return;
      }

      bigicon.textContent = it.icon || (it.kind === "folder" ? "üìÅ" : "üìÑ");
      previewLabel.textContent = it.path;

      const modified = it.modified && it.modified !== "‚Äî" ? it.modified : nowDate();
      const size = it.size || "‚Äî";

      kv.innerHTML = `
        <div class="k">Name</div><div class="v" title="${it.name}">${it.name}</div>
        <div class="k">Type</div><div class="v" title="${it.type}">${it.type}</div>
        <div class="k">Path</div><div class="v" title="${it.path}">${it.path}</div>
        <div class="k">Modified</div><div class="v" title="${modified}">${modified}</div>
        <div class="k">Size</div><div class="v" title="${size}">${size}</div>
      `;
      sbRight.textContent = it.kind === "folder" ? "Folder selected" : "File selected";
    }

    function renderRows(){
      rowsEl.innerHTML = "";
      applyFilter();

      filtered.forEach((e, idx)=>{
        const row = document.createElement("div");
        row.className = "row" + (idx === selectedIndex ? " selected" : "");
        row.tabIndex = 0;

        const date = e.modified && e.modified !== "‚Äî" ? e.modified : nowDate();

        row.innerHTML = `
          <div class="cellname">
            <div class="fileicon">${e.icon || (e.kind==="folder" ? "üìÅ" : "üìÑ")}</div>
            <div class="nametext">
              <b title="${e.name}">${e.name}</b>
              <span>${e.path}</span>
            </div>
          </div>
          <div class="type">${e.type}</div>
          <div class="modified">${date}</div>
        `;

        row.addEventListener("click", ()=>{
          selectedIndex = idx;
          hideCtx();
          renderRows(); // re-render to update highlight
        });

        row.addEventListener("dblclick", ()=>{
          selectedIndex = idx;
          hideCtx();
          openSelected();
        });

        row.addEventListener("contextmenu", (ev)=>{
          ev.preventDefault();
          selectedIndex = idx;
          renderRows();
          showCtx(ev.clientX, ev.clientY);
        });

        rowsEl.appendChild(row);
      });

      // default select first item when entering folder
      if(selectedIndex === -1 && filtered.length) selectedIndex = 0;

      // update status bar + details
      sbLeft.textContent = `${filtered.length} item${filtered.length===1?"":"s"}`;
      updateDetails();

      // apply highlight without recursion loop
      const rows = rowsEl.querySelectorAll(".row");
      rows.forEach((r,i)=> r.classList.toggle("selected", i===selectedIndex));
    }

    function renderBreadcrumbs(){
      const parts = [];
      parts.push({ label:"This PC", path:null });
      parts.push({ label:"NoxiustDrive", path:"" });

      if(currentPath){
        const segs = currentPath.split("/").filter(Boolean);
        let accum = "";
        for(const s of segs){
          accum += s + "/";
          parts.push({ label: s, path: accum });
        }
      }

      addr.innerHTML = parts.map((p,i)=>{
        const sep = i===0 ? "" : `<span class="sep">‚Ä∫</span>`;
        if(p.path === null){
          return `${sep}<span class="crumb"><span>${p.label}</span></span>`;
        }
        return `${sep}<span class="crumb"><button data-path="${p.path}">${p.label}</button></span>`;
      }).join("");

      addr.querySelectorAll("button[data-path]").forEach(btn=>{
        btn.addEventListener("click", ()=> navigate(btn.dataset.path));
      });

      // Also keep editable path
      addrEdit.value = currentPath || "";
    }

    function renderTree(){
      treeEl.innerHTML = "";

      function renderNode(node, depth){
        const hasKids = Array.isArray(node.children) && node.children.length>0;
        const isExpanded = expanded.has(node.id);

        const wrap = document.createElement("div");
        wrap.style.marginLeft = (depth * 10) + "px";

        const line = document.createElement("div");
        line.className = "node" + (node.path !== undefined && normalizePath(node.path) === currentPath ? " active" : "");
        line.tabIndex = 0;

        const twisty = document.createElement("div");
        twisty.className = "twisty";
        twisty.textContent = hasKids ? (isExpanded ? "‚ñæ" : "‚ñ∏") : "";

        const icon = document.createElement("div");
        icon.className = "icon";
        icon.textContent = node.icon || "üìÅ";

        const label = document.createElement("div");
        label.className = "label";
        label.innerHTML = `<b>${node.name}</b><span>${node.hint || ""}</span>`;

        line.appendChild(twisty);
        line.appendChild(icon);
        line.appendChild(label);
        wrap.appendChild(line);

        if(hasKids){
          const kids = document.createElement("div");
          kids.className = "children" + (isExpanded ? " show" : "");
          node.children.forEach(ch => kids.appendChild(renderNode(ch, depth+1)));
          wrap.appendChild(kids);

          twisty.addEventListener("click", (ev)=>{
            ev.stopPropagation();
            if(expanded.has(node.id)) expanded.delete(node.id);
            else expanded.add(node.id);
            renderTree();
          });
        }

        line.addEventListener("click", ()=>{
          hideCtx();
          if(node.path !== undefined) navigate(node.path);
          else if(hasKids){
            if(expanded.has(node.id)) expanded.delete(node.id);
            else expanded.add(node.id);
            renderTree();
          }
        });

        line.addEventListener("keydown", (ev)=>{
          if(ev.key === "Enter"){
            ev.preventDefault();
            if(node.path !== undefined) navigate(node.path);
            else if(hasKids){
              if(expanded.has(node.id)) expanded.delete(node.id);
              else expanded.add(node.id);
              renderTree();
            }
          }
          if(ev.key === "ArrowRight" && hasKids && !isExpanded){
            expanded.add(node.id); renderTree();
          }
          if(ev.key === "ArrowLeft" && hasKids && isExpanded){
            expanded.delete(node.id); renderTree();
          }
        });

        return wrap;
      }

      TREE.forEach(n => treeEl.appendChild(renderNode(n,0)));
    }

    function renderToolbarState(){
      backBtn.disabled = backStack.length === 0;
      forwardBtn.disabled = forwardStack.length === 0;
      upBtn.disabled = currentPath === "";
      openBtn.disabled = !selectedItem();
    }

    function renderAll(){
      renderBreadcrumbs();
      renderTree();
      renderRows();
      renderToolbarState();
    }

    /* =======================
       Context Menu
       ======================= */
    function showCtx(x,y){
      ctxMenu.style.display = "block";
      const pad = 8;
      const w = ctxMenu.offsetWidth;
      const h = ctxMenu.offsetHeight;
      const maxX = window.innerWidth - w - pad;
      const maxY = window.innerHeight - h - pad;
      ctxMenu.style.left = Math.max(pad, Math.min(x, maxX)) + "px";
      ctxMenu.style.top  = Math.max(pad, Math.min(y, maxY)) + "px";
      updateDetails();
    }
    function hideCtx(){ ctxMenu.style.display = "none"; }

    document.addEventListener("contextmenu", (ev)=>{
      // prevent browser menu anywhere inside app
      if(ev.target.closest(".window")){
        ev.preventDefault();
        if(!ev.target.closest(".row")) hideCtx();
      }
    });
    document.addEventListener("click", (ev)=>{
      if(!ev.target.closest(".ctx")) hideCtx();
    });
    window.addEventListener("resize", hideCtx);

    ctxOpen.addEventListener("click", ()=>{
      hideCtx();
      openSelected();
    });

    /* =======================
       Address edit (Ctrl+L / click)
       ======================= */
    function startAddrEdit(){
      addr.style.display = "none";
      addrEdit.style.display = "block";
      addrEdit.focus();
      addrEdit.select();
    }
    function endAddrEdit(apply){
      addrEdit.style.display = "none";
      addr.style.display = "flex";
      if(apply){
        const raw = (addrEdit.value || "").trim();
        // allow: "", "documents/", "pictures/wallpapers/" ...
        const p = raw ? normalizePath(raw) : "";
        if(FS[p] !== undefined) navigate(p);
        else {
          // if unknown path, just revert (no warning text)
          addrEdit.value = currentPath || "";
        }
      }else{
        addrEdit.value = currentPath || "";
      }
    }
    addr.addEventListener("click", startAddrEdit);
    addrEdit.addEventListener("keydown", (ev)=>{
      if(ev.key === "Enter") endAddrEdit(true);
      if(ev.key === "Escape") endAddrEdit(false);
    });
    addrEdit.addEventListener("blur", ()=> endAddrEdit(false));

    /* =======================
       Keyboard (Windows-like)
       ======================= */
    rowsEl.addEventListener("keydown", (ev)=>{
      if(filtered.length === 0) return;

      if(ev.key === "ArrowDown"){
        ev.preventDefault();
        selectedIndex = Math.min(filtered.length-1, selectedIndex + 1);
        renderRows();
        scrollSelectionIntoView();
      }
      if(ev.key === "ArrowUp"){
        ev.preventDefault();
        selectedIndex = Math.max(0, selectedIndex - 1);
        renderRows();
        scrollSelectionIntoView();
      }
      if(ev.key === "Enter"){
        ev.preventDefault();
        openSelected();
      }
      if(ev.key === "Backspace"){
        ev.preventDefault();
        goUp();
      }
    });

    document.addEventListener("keydown", (ev)=>{
      // Ctrl+L => edit address
      if(ev.ctrlKey && (ev.key === "l" || ev.key === "L")){
        ev.preventDefault();
        startAddrEdit();
      }
      // Alt+Left/Right => back/forward
      if(ev.altKey && ev.key === "ArrowLeft"){ ev.preventDefault(); goBack(); }
      if(ev.altKey && ev.key === "ArrowRight"){ ev.preventDefault(); goForward(); }
    });

    function scrollSelectionIntoView(){
      const rows = rowsEl.querySelectorAll(".row");
      const el = rows[selectedIndex];
      if(!el) return;
      const rect = el.getBoundingClientRect();
      const parentRect = rowsEl.getBoundingClientRect();
      if(rect.top < parentRect.top) el.scrollIntoView({block:"nearest"});
      if(rect.bottom > parentRect.bottom) el.scrollIntoView({block:"nearest"});
    }

    /* =======================
       Events
       ======================= */
    backBtn.addEventListener("click", goBack);
    forwardBtn.addEventListener("click", goForward);
    upBtn.addEventListener("click", goUp);
    openBtn.addEventListener("click", openSelected);
    refreshBtn.addEventListener("click", ()=>{ hideCtx(); renderAll(); });

    searchBox.addEventListener("input", ()=>{
      selectedIndex = -1;
      hideCtx();
      renderRows();
    });

    collapseAllBtn.addEventListener("click", ()=>{
      expanded = new Set(["qa","thispc"]);
      renderTree();
    });

    // clicking blank space in list clears context menu
    document.getElementById("list").addEventListener("click", (ev)=>{
      if(!ev.target.closest(".row")) hideCtx();
    });

    /* =======================
       Lock Screen behavior
       ======================= */
    function tickLock(){
      const d = new Date();
      lockTime.textContent = d.toLocaleTimeString([], {hour:"2-digit", minute:"2-digit"});
      lockDate.textContent = d.toLocaleDateString([], {weekday:"long", year:"numeric", month:"long", day:"numeric"});
    }
    tickLock();
    setInterval(tickLock, 1000);

    lock.addEventListener("click", ()=>{
      if(!signin.classList.contains("show")) showSignin();
    });
    document.addEventListener("keydown", (ev)=>{
      if(!lock.classList.contains("show")) return;

      if(!signin.classList.contains("show") && (ev.key === "Enter" || ev.key === " ")){
        ev.preventDefault();
        showSignin();
      }else if(signin.classList.contains("show") && ev.key === "Escape"){
        ev.preventDefault();
        hideSignin();
      }
    });

    cancelBtn.addEventListener("click", hideSignin);

    async function attemptLogin(){
      const u = userEl.value.trim();
      const p = passEl.value;

      // no tips ‚Äî just generic failure
      msg.textContent = "";

      if(!u || !p){ msg.textContent = "Invalid username or password."; return; }
      if(u !== EXPECTED_USER){ msg.textContent = "Invalid username or password."; return; }

      const candidate = `${u}:${p}:${SALT}`;
      const h = await sha256Hex(candidate);

      if(h === EXPECTED_HASH_HEX){
        sessionStorage.setItem("auth_ok", "1");
        setLocked(false);
        showLock(false);
        msg.textContent = "";
        passEl.value = "";
        // focus list for keyboard nav
        setTimeout(()=>rowsEl.focus(), 50);
      }else{
        msg.textContent = "Invalid username or password.";
      }
    }

    submitBtn.addEventListener("click", attemptLogin);
    passEl.addEventListener("keydown", (ev)=>{ if(ev.key === "Enter") attemptLogin(); });
    userEl.addEventListener("keydown", (ev)=>{ if(ev.key === "Enter") passEl.focus(); });

    loginBtn.addEventListener("click", ()=>{
      showLock(true);
    });

    logoutBtn.addEventListener("click", ()=>{
      sessionStorage.removeItem("auth_ok");
      setLocked(true);
      showLock(true);
    });

    /* =======================
       Init
       ======================= */
    renderAll();

    const authed = sessionStorage.getItem("auth_ok") === "1";
    setLocked(!authed);
    showLock(!authed);
    if(!authed) setTimeout(()=>{}, 0);
  </script>
</body>
</html>
